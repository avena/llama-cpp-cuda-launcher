{{- bos_token }}
{%- if messages[0]['role'] == 'system' %}
    {%- set system_message = messages[0]['content'] %}
    {%- set loop_messages = messages[1:] %}
{%- else %}
    {%- set system_message = 'You are an AI programming assistant, utilizing the DeepSeek Coder model, developed by DeepSeek Company, and you only answer questions related to computer science. For politically sensitive questions, security and privacy issues, and other non-computer science questions, you will refuse to answer.' %}
    {%- set loop_messages = messages %}
{%- endif %}
{{ system_message }}
{%- for message in loop_messages %}
    {%- if (message['role'] == 'user') != (loop.index0 % 2 == 0) %}
        {{- raise_exception('Conversation roles must alternate user/assistant/user/assistant...') }}
    {%- endif %}
    {%- if message['role'] == 'user' %}
        {{- '### Instruction:\n' + message['content'] + '\n' }}
    {%- elif message['role'] == 'assistant' %}
        {{- '### Response:\n' + message['content'] + '\n<|EOT|>\n' }}
    {%- endif %}
{%- endfor %}
{%- if add_generation_prompt %}
    {{- '### Response:\n' }}
{%- endif %}
